#!/bin/bash
# =============================================================================
# AI CLI Tools Container Launcher
# Run from any directory to start the container with that directory mounted
# =============================================================================

set -e

IMAGE_NAME="ai-cli-tools:latest"
CONTAINER_NAME="ai-cli-tools"

# Volumes for persistent auth (different tools use different locations)
CONFIG_VOLUME="ai-cli-config"
CLAUDE_VOLUME="ai-cli-claude"
CODEX_VOLUME="ai-cli-codex"
AIDER_VOLUME="ai-cli-aider"

# Use current directory as workspace
WORKSPACE_DIR="${1:-$(pwd)}"

# Check if image exists
if ! docker image inspect "$IMAGE_NAME" &>/dev/null; then
    echo "Error: Docker image '$IMAGE_NAME' not found."
    echo "Please build it first: make build (from container-tools directory)"
    exit 1
fi

# Run the container with all auth volumes mounted
exec docker run -it --rm \
    --name "$CONTAINER_NAME" \
    -v "$WORKSPACE_DIR":/workspace \
    -v "$CONFIG_VOLUME":/home/devuser/.config \
    -v "$CLAUDE_VOLUME":/home/devuser/.claude \
    -v "$CODEX_VOLUME":/home/devuser/.codex \
    -v "$AIDER_VOLUME":/home/devuser/.aider \
    -e TERM=xterm-256color \
    -e HOST_PWD="$WORKSPACE_DIR" \
    -e CLAUDE_CONFIG_DIR=/home/devuser/.claude \
    "$IMAGE_NAME"

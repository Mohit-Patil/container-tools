services:
  ai-tools:
    build:
      context: .
      dockerfile: Dockerfile
    image: ai-cli-tools:latest
    container_name: ai-cli-tools

    # Interactive TTY for CLI tools
    stdin_open: true
    tty: true

    # Volumes
    volumes:
      # Mount current directory as workspace (:cached improves I/O on macOS)
      - .:/workspace:cached
      # Named volumes for persistent auth/config
      - ai-cli-config:/home/devuser/.config
      - ai-cli-claude:/home/devuser/.claude
      - ai-cli-codex:/home/devuser/.codex
      # Mount git config and SSH keys from host
      - ~/.gitconfig:/home/devuser/.gitconfig:ro
      - ~/.ssh:/home/devuser/.ssh:ro

    # Environment variables
    environment:
      - TERM=xterm-256color
      - COLORTERM=truecolor
      - HOST_PWD=${PWD}
      - CLAUDE_CONFIG_DIR=/home/devuser/.claude
      - XDG_CONFIG_HOME=/home/devuser/.config
      - XDG_CACHE_HOME=/home/devuser/.cache
      - XDG_DATA_HOME=/home/devuser/.local/share
      - CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1

    # Load environment from file (if exists)
    env_file:
      - path: .env
        required: false

    # Working directory
    working_dir: /workspace

    # Default command
    command: /bin/bash

volumes:
  ai-cli-config:
    name: ai-cli-config
  ai-cli-claude:
    name: ai-cli-claude
  ai-cli-codex:
    name: ai-cli-codex
